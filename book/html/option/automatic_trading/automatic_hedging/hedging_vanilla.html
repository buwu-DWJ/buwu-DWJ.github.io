<!DOCTYPE HTML>
<html lang="chs" class="sidebar-visible no-js light">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>hedging_vanilla - ğŸ¤£ğŸ‘‰buwu_dwjğŸ¤¡ğŸ‘ˆğŸ˜…_srcbk</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="../../../favicon.svg">
    <link rel="shortcut icon" href="../../../favicon.png">
    <link rel="stylesheet" href="../../../css/variables.css">
    <link rel="stylesheet" href="../../../css/general.css">
    <link rel="stylesheet" href="../../../css/chrome.css">
    <link rel="stylesheet" href="../../../css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="../../../fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../../../highlight.css">
    <link rel="stylesheet" href="../../../tomorrow-night.css">
    <link rel="stylesheet" href="../../../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="../../../theme/style3.css">


</head>

<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "../../../";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');
            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }
            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item affix "><a href="../../../pre.html">å‰è¨€</a></li><li class="chapter-item affix "><li class="part-title">Summary</li><li class="chapter-item "><a href="../../../markdown/markdown.html"><strong aria-hidden="true">1.</strong> markdown&latex</a></li><li class="chapter-item "><a href="../../../python/python.html"><strong aria-hidden="true">2.</strong> python</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../python/np_pd/np_pd.html"><strong aria-hidden="true">2.1.</strong> np&pd</a></li><li class="chapter-item "><a href="../../../python/matplotlib/matplotlib.html"><strong aria-hidden="true">2.2.</strong> matplotlib</a></li><li class="chapter-item "><a href="../../../python/tkinter/tkinter.html"><strong aria-hidden="true">2.3.</strong> tkinter</a></li><li class="chapter-item "><a href="../../../python/crawler/pre.html"><strong aria-hidden="true">2.4.</strong> crawler</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../python/crawler/BeautifulSoup.html"><strong aria-hidden="true">2.4.1.</strong> BeautifulSoup</a></li><li class="chapter-item "><a href="../../../python/crawler/re.html"><strong aria-hidden="true">2.4.2.</strong> re</a></li></ol></li><li class="chapter-item "><a href="../../../python/pytorch/pytorch.html"><strong aria-hidden="true">2.5.</strong> pytorch</a></li><li class="chapter-item "><a href="../../../python/pythonä¹‹ç¦…/pre.html"><strong aria-hidden="true">2.6.</strong> pythonä¹‹ç¦…</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../python/pythonä¹‹ç¦…/optim.html"><strong aria-hidden="true">2.6.1.</strong> ç»“æ„ä¸Šä¼˜åŒ–è¿è¡Œé€Ÿåº¦</a></li><li class="chapter-item "><a href="../../../python/pythonä¹‹ç¦…/python_optim.html"><strong aria-hidden="true">2.6.2.</strong> å…¶ä»–ç»†èŠ‚</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../../rust/pre.html"><strong aria-hidden="true">3.</strong> Rust</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../rust/basic/pre.html"><strong aria-hidden="true">3.1.</strong> åŸºç¡€çŸ¥è¯†</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../rust/basic/basic.html"><strong aria-hidden="true">3.1.1.</strong> å®‰è£…åŠå…¶ä»–</a></li><li class="chapter-item "><a href="../../../rust/basic/variable.html"><strong aria-hidden="true">3.1.2.</strong> å˜é‡ç»‘å®šä¸è§£æ„</a></li><li class="chapter-item "><a href="../../../rust/basic/ownership/pre.html"><strong aria-hidden="true">3.1.3.</strong> æ‰€æœ‰æƒ,å¼•ç”¨ä¸å€Ÿç”¨</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../rust/basic/ownership/ownership.html"><strong aria-hidden="true">3.1.3.1.</strong> æ‰€æœ‰æƒ</a></li><li class="chapter-item "><a href="../../../rust/basic/ownership/borrowing.html"><strong aria-hidden="true">3.1.3.2.</strong> å¼•ç”¨ä¸å€Ÿç”¨</a></li></ol></li><li class="chapter-item "><a href="../../../rust/basic/compound_type/pre.html"><strong aria-hidden="true">3.1.4.</strong> å¤åˆç±»å‹</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../rust/basic/compound_type/string_slice.html"><strong aria-hidden="true">3.1.4.1.</strong> å­—ç¬¦ä¸²ä¸åˆ‡ç‰‡</a></li><li class="chapter-item "><a href="../../../rust/basic/compound_type/tuple.html"><strong aria-hidden="true">3.1.4.2.</strong> å…ƒç»„</a></li><li class="chapter-item "><a href="../../../rust/basic/compound_type/struct.html"><strong aria-hidden="true">3.1.4.3.</strong> ç»“æ„ä½“</a></li><li class="chapter-item "><a href="../../../rust/basic/compound_type/enum.html"><strong aria-hidden="true">3.1.4.4.</strong> æšä¸¾</a></li><li class="chapter-item "><a href="../../../rust/basic/compound_type/array.html"><strong aria-hidden="true">3.1.4.5.</strong> æ•°ç»„</a></li></ol></li><li class="chapter-item "><a href="../../../rust/basic/flow_control.html"><strong aria-hidden="true">3.1.5.</strong> æµå¼æ§åˆ¶</a></li><li class="chapter-item "><a href="../../../rust/basic/match_pattern/pre.html"><strong aria-hidden="true">3.1.6.</strong> æ¨¡å¼åŒ¹é…</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../rust/basic/match_pattern/if_let.html"><strong aria-hidden="true">3.1.6.1.</strong> if_let</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><a href="../../../ml/ml.html"><strong aria-hidden="true">4.</strong> ML</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../ml/pre/pre.html"><strong aria-hidden="true">4.1.</strong> ç»ªè¨€</a></li><li class="chapter-item "><a href="../../../ml/chapter2/chapter2.html"><strong aria-hidden="true">4.2.</strong> æ¨¡å‹çš„è¯„ä¼°ä¸é€‰æ‹©</a></li><li class="chapter-item "><a href="../../../ml/chapter3/chapter3.html"><strong aria-hidden="true">4.3.</strong> çº¿æ€§æ¨¡å‹</a></li><li class="chapter-item "><a href="../../../ml/chapter4/chapter4.html"><strong aria-hidden="true">4.4.</strong> å†³ç­–æ ‘</a></li><li class="chapter-item "><a href="../../../ml/chapter5/chapter5.html"><strong aria-hidden="true">4.5.</strong> ç¥ç»ç½‘ç»œ</a></li><li class="chapter-item "><a href="../../../ml/chapter6/chapter6.html"><strong aria-hidden="true">4.6.</strong> æ”¯æŒå‘é‡æœº</a></li><li class="chapter-item "><a href="../../../ml/chapter7/chapter7.html"><strong aria-hidden="true">4.7.</strong> è´å¶æ–¯åˆ†ç±»å™¨</a></li><li class="chapter-item "><a href="../../../ml/chapter8/chapter8.html"><strong aria-hidden="true">4.8.</strong> EMç®—æ³•</a></li><li class="chapter-item "><a href="../../../ml/chapter9/chapter9.html"><strong aria-hidden="true">4.9.</strong> é›†æˆå­¦ä¹ </a></li><li class="chapter-item "><a href="../../../ml/chapter10/chapter10.html"><strong aria-hidden="true">4.10.</strong> èšç±»ç®—æ³•</a></li><li class="chapter-item "><a href="../../../ml/chapter11/chapter11.html"><strong aria-hidden="true">4.11.</strong> é™ç»´ä¸åº¦é‡å­¦ä¹ </a></li><li class="chapter-item "><a href="../../../ml/chapter12/chapter12.html"><strong aria-hidden="true">4.12.</strong> ç‰¹å¾é€‰æ‹©ä¸ç¨€ç–å­¦ä¹ </a></li><li class="chapter-item "><a href="../../../ml/chapter13/chapter13.html"><strong aria-hidden="true">4.13.</strong> è®¡ç®—å­¦ä¹ ç†è®º</a></li><li class="chapter-item "><a href="../../../ml/chapter14/chapter14.html"><strong aria-hidden="true">4.14.</strong> åŠç›‘ç£å­¦ä¹ </a></li><li class="chapter-item "><a href="../../../ml/chapter15/chapter15.html"><strong aria-hidden="true">4.15.</strong> æ¦‚ç‡å›¾æ¨¡å‹</a></li><li class="chapter-item "><a href="../../../ml/chapter16/chapter16.html"><strong aria-hidden="true">4.16.</strong> å¼ºåŒ–å­¦ä¹ </a></li></ol></li><li class="chapter-item "><a href="../../../nn/basic.html"><strong aria-hidden="true">5.</strong> NN</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../nn/feedforward.html"><strong aria-hidden="true">5.1.</strong> å‰é¦ˆç¥ç»ç½‘ç»œ</a></li><li class="chapter-item "><a href="../../../nn/memory.html"><strong aria-hidden="true">5.2.</strong> å¾ªç¯ç¥ç»ç½‘ç»œ</a></li><li class="chapter-item "><a href="../../../nn/GAN.html"><strong aria-hidden="true">5.3.</strong> ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ</a></li><li class="chapter-item "><a href="../../../nn/graph.html"><strong aria-hidden="true">5.4.</strong> å›¾ç¥ç»ç½‘ç»œ</a></li></ol></li><li class="chapter-item "><a href="../../../DRL/DRL.html"><strong aria-hidden="true">6.</strong> DRL</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../DRL/RL.html"><strong aria-hidden="true">6.1.</strong> RL</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../DRL/RL/chapter1/chapter1.html"><strong aria-hidden="true">6.1.1.</strong> æœ‰æ¨¡å‹æ•°å€¼è¿­ä»£</a></li><li class="chapter-item "><a href="../../../DRL/RL/chapter2/chapter2.html"><strong aria-hidden="true">6.1.2.</strong> å›åˆæ›´æ–°ä»·å€¼è¿­ä»£</a></li><li class="chapter-item "><a href="../../../DRL/RL/chapter3/chapter3.html"><strong aria-hidden="true">6.1.3.</strong> æ—¶åºå·®åˆ†ä»·å€¼è¿­ä»£</a></li><li class="chapter-item "><a href="../../../DRL/RL/chapter4/chapter4.html"><strong aria-hidden="true">6.1.4.</strong> å‡½æ•°è¿‘ä¼¼æ–¹æ³•</a></li><li class="chapter-item "><a href="../../../DRL/RL/chapter5/chapter5.html"><strong aria-hidden="true">6.1.5.</strong> å›åˆæ›´æ–°ç­–ç•¥æ¢¯åº¦æ–¹æ³•</a></li><li class="chapter-item "><a href="../../../DRL/RL/chapter6/chapter6.html"><strong aria-hidden="true">6.1.6.</strong> æ‰§è¡Œè€…/è¯„è®ºè€…æ–¹æ³•</a></li><li class="chapter-item "><a href="../../../DRL/RL/chapter7/chapter7.html"><strong aria-hidden="true">6.1.7.</strong> è¿ç»­åŠ¨ä½œç©ºé—´çš„ç¡®å®šæ€§ç­–ç•¥</a></li></ol></li><li class="chapter-item "><a href="../../../DRL/fin.html"><strong aria-hidden="true">6.2.</strong> FIN</a></li><li class="chapter-item "><a href="../../../DRL/DRL.html"><strong aria-hidden="true">6.3.</strong> DRL</a></li></ol></li><li class="chapter-item expanded "><a href="../../../option/option.html"><strong aria-hidden="true">7.</strong> Option</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../option/basic/pre.html"><strong aria-hidden="true">7.1.</strong> æœŸæƒåŸºç¡€æ¦‚å¿µ</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../option/basic/basic.html"><strong aria-hidden="true">7.1.1.</strong> åŸºç¡€çŸ¥è¯†</a></li><li class="chapter-item "><a href="../../../option/basic/spread.html"><strong aria-hidden="true">7.1.2.</strong> ä»·å·®</a></li><li class="chapter-item "><a href="../../../option/basic/theorems.html"><strong aria-hidden="true">7.1.3.</strong> æ·±å…¥å¸Œè…Šå€¼</a></li></ol></li><li class="chapter-item "><a href="../../../option/models/pre.html"><strong aria-hidden="true">7.2.</strong> æœŸæƒæ¨¡å‹</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../option/models/sv.html"><strong aria-hidden="true">7.2.1.</strong> ç»å…¸SV</a></li><li class="chapter-item "><a href="../../../option/models/rough.html"><strong aria-hidden="true">7.2.2.</strong> RV</a></li><li class="chapter-item "><a href="../../../option/models/wing_model.html"><strong aria-hidden="true">7.2.3.</strong> wing_model</a></li></ol></li><li class="chapter-item expanded "><a href="../../../option/automatic_trading/automatic_trading_pre.html"><strong aria-hidden="true">7.3.</strong> Automatic_Trading</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../option/automatic_trading/automatic_hedging/automatic_hedging_pre.html"><strong aria-hidden="true">7.3.1.</strong> Automatic_Hedging</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../option/automatic_trading/automatic_hedging/hedging_vanilla.html" class="active"><strong aria-hidden="true">7.3.1.1.</strong> hedging_vanilla</a></li></ol></li></ol></li></ol></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
                        <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button>
                        </li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                        aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                        aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">ğŸ¤£ğŸ‘‰buwu_dwjğŸ¤¡ğŸ‘ˆğŸ˜…_srcbk</h1>

                <div class="right-buttons">
                    <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>

                </div>
            </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                        aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');

                // Get viewed page store
                var viewed_key = 'mdbook-viewed';
                var viewed_map = {};
                try {
                    var viewed_storage = localStorage.getItem(viewed_key);
                    if (viewed_storage) {
                        viewed_map = JSON.parse(viewed_storage)
                    }
                } catch (e) { }

                Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);

                    // Apply viewed style
                    if (viewed_map[link.pathname]) {
                        link.classList.add('md-viewed')
                    }
                });

                // Mark viewed after 30s
                setTimeout(function () {
                    viewed_map[location.pathname] = 1;
                    localStorage.setItem(viewed_key, JSON.stringify(viewed_map));
                }, 30000)
            </script>

            <div id="content" class="content">
                <!-- Page table of contents -->
                <div class="sidetoc">
                    <nav class="pagetoc"></nav>
                </div>
                <main>
                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="æœ€ç®€å•æƒ…å½¢çš„è‡ªåŠ¨å¯¹å†²"><a class="header" href="#æœ€ç®€å•æƒ…å½¢çš„è‡ªåŠ¨å¯¹å†²">æœ€ç®€å•æƒ…å½¢çš„è‡ªåŠ¨å¯¹å†²</a></h1>
<h2 id="ç®€ä»‹"><a class="header" href="#ç®€ä»‹">ç®€ä»‹</a></h2>
<p>æœ¬è‡ªåŠ¨å¯¹å†²æ˜¯ä¸ç­–ç•¥ä¸‹å•<code>ç›¸äº’ç‹¬ç«‹</code>ï¼Œç­–ç•¥ä¸‹å•æ‰€éœ€è¦çš„ä¸‹å•ä¸­ä¿æŒå¯¹å†²ä¼šé›†æˆåœ¨ç­–ç•¥ä¸‹å•çš„ä»£ç ä¸­ï¼Œæœ¬ç« çš„è‡ªåŠ¨å¯¹å†²é€‚ç”¨äºåœ¨æœªè§¦å‘ç­–ç•¥ä¿¡å·æ—¶çš„é¢å¤–å¯¹å†²æ“ä½œï¼Œå¦‚æœæœ‰å…¶ä»–è‡ªåŠ¨äº¤æ˜“çš„ç­–ç•¥è§¦å‘æ—¶ï¼Œåº”è¯¥åœæ­¢å¯¹åº”çš„åˆçº¦çš„è‡ªåŠ¨å¯¹å†²æ“ä½œã€‚</p>
<p>é€‰ç”¨è¿‘æœˆæˆ–æ¬¡æœˆï¼ˆå¯é€‰ï¼‰ç¦»åˆæˆæœŸè´§æœ€è¿‘çš„è¡Œæƒä»·å¯¹åº”çš„åˆæˆæœŸè´§å¯¹ä½œä¸ºå¯¹å†²åˆçº¦ï¼›
æ‰‹åŠ¨å¡«å…¥æœ¬æ¬¡çš„ç›®æ ‡$deltaä»¥åŠå¯ä»¥æ¥å—çš„ä¸€ä¸ªä¸Šä¸‹èŒƒå›´åŒºé—´ï¼Œå¯¹å†²å¿…é¡»è¦è¾¾åˆ°ç›®æ ‡$deltaä¸€æ¬¡åæ‰ä¼šè€ƒè™‘ä¸Šä¸‹èŒƒå›´ï¼›
ä¾‹å­ï¼šå½“å‰å®é™…$deltaä¸º5%ï¼Œç›®æ ‡$deltaä¸º20%ï¼Œç»™å®šçš„ä¸Šä¸‹å®¹å¿èŒƒå›´ä¸º10%ï¼Œé‚£ä¹ˆåˆšå¼€å§‹å¯¹å†²çš„æƒ…å½¢ä¸‹ï¼Œ$delta<strong>å¿…é¡»åˆ°è¾¾ä¸€æ¬¡20%æ‰åœæ­¢</strong>è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œåç»­æ‰ä¼šåˆ¤æ–­$deltaå‡ºäº†ç›®æ ‡$delta20%ä¸Šä¸‹10%å»åšå¯¹å†²ï¼Œä¹Ÿå°±æ˜¯ä½äº10%æˆ–é«˜äº30%.</p>
<p>$vegaæ–¹é¢ï¼Œä¸åŒäº$deltaæˆ‘ä»¬ç»™å®šçš„æ˜¯ç›®æ ‡$deltaï¼Œ$vegaæˆ‘ä»¬ä¼šç»™ä¸€ä¸ª<strong>æœ¬æ¬¡$vega</strong>ï¼Œ$vegaæˆ‘ä»¬ä¼šå®æ—¶è®¡ç®—ä»æœ¬æ¬¡å¯¹å†²å¼€å§‹ä¸‹çš„å•å¯¹åº”çš„$vegaï¼Œè¯¥$vegaæœªåˆ°è®¾å®šçš„<strong>æœ¬æ¬¡è¦åšçš„$vega</strong>å‰æˆ‘ä»¬åªç”¨callæˆ–è€…putå»åšå¯¹å†²ï¼Œåœ¨è¯¥$vegaè¾¾åˆ°<strong>æœ¬æ¬¡è¦åšçš„$vega</strong>åæˆ‘ä»¬åªä¼šç”¨åˆæˆæœŸè´§å»è¿›è¡Œå¯¹å†²ï¼›ä¸‹çš„å•å¯¹åº”çš„$vegaåˆ°è¿‡ä¸€æ¬¡<strong>æœ¬æ¬¡è¦åšçš„$vega</strong>åå°±å†ä¹Ÿä¸è€ƒè™‘$vegaè¿™ä¸€å¸Œè…Šå€¼äº†</p>
<blockquote>
<p>TODO:è¿½ä»·ç±»å‹ç›®å‰æ˜¯'aT|b|c|M/C'çš„å½¢å¼, åç»­å¸Œæœ›èƒ½å¤Ÿæœ‰æ›´å¤šçš„è‡ªå®šä¹‰æ“ä½œï¼Œå¦‚ä½œä¸ºä¹°æ–¹æ—¶æ¯æ¬¡ä»¥min(å¯¹æ‰‹ä»·+2T, å‰ä¸€ç¬”+2T)çš„ä»·æ ¼è¿›è¡Œè¿½ä»·ï¼Œå¾…è®¨è®º</p>
</blockquote>
<h2 id="æµç¨‹å›¾"><a class="header" href="#æµç¨‹å›¾">æµç¨‹å›¾</a></h2>
<p><img src="img/vanilla.svg" alt="" /></p>
<h2 id="guiä»£ç éƒ¨åˆ†"><a class="header" href="#guiä»£ç éƒ¨åˆ†">GUIä»£ç éƒ¨åˆ†</a></h2>
<p>éœ€è¦æ¨¡å— icetcore, loguru</p>
<pre><code class="language-python">#!/usr/bin/env python
# -*- encoding: utf-8 -*-
'''
@File    :   hedger_vanilla.py
@Time    :   2023/02/15 20:55:33
@Author  :   DingWenjie
@Contact :   359582058@qq.com
@Desc    :   ### ç‹¬ç«‹è‡ªåŠ¨å¯¹å†²æ¨¡å— ###
                 å¯¹å†²åˆçº¦: å¹³å€¼åˆæˆæœŸè´§
                 éœ€è¦è¾“å…¥: å¯¹å†²æœˆä»½: è¿‘æœˆ/æ¬¡æœˆ
                          ç›®æ ‡delta: ç™¾åˆ†å€¼
                          ç›®æ ‡deltaå®¹å¿èŒƒå›´: æ­£ç™¾åˆ†å€¼
                          æœ¬æ¬¡å¯¹å†²vega: ä¸‡åˆ†å€¼
                          ä¸‹å•æ¨¡å¼: å¯é€‰ æœ¬æ–¹ä»·+1/å¯¹æ‰‹ä»·-1/ä¸­é—´ä»·
                          ç›¸é‚»å•é—´éš”: int,ç§’
                          è¿½ä»·æ¨¡å¼:
                          æ¯ç¬”å•æ•°: int
             ### å¯¹å†²é€»è¾‘ ###
                 ä»¥ç›®æ ‡deltaä¸ºä¸», é¦–æ¬¡å¯¹å†²(first_time)å¿…é¡»deltaè¾¾åˆ°ç›®æ ‡delta,
                 éé¦–æ¬¡æ—¶deltaå¿…é¡»è¾¾åˆ°ç›®æ ‡deltaçš„å®¹å¿èŒƒå›´å†…,
                 vegaåˆ™æ˜¯ä»¥æœ¬æ¬¡å¯¹å†²ä¸ºå‡†, ä¸çœ‹æ€»ä»“ä½çš„vega, æœªè¾¾åˆ°æœ¬æ¬¡å¯¹å†²vegaæ—¶,
                 åªä¹°(å–)ä¸å–(ä¹°), åˆ°è¾¾æœ¬æ¬¡å¯¹å†²vegaå, ä½¿ç”¨åˆæˆæœŸè´§å¯¹å†²
'''


import warnings
import datetime
import os
from loguru import logger
from tkinter import ttk, Tk, Label, Entry, StringVar, Button
from copy import deepcopy
from icetcore import TCoreAPI, QuoteEvent, TradeEvent, OrderStruct
from functools import partial
from threading import Thread
from time import sleep


now = datetime.datetime.now()
TODAY_STR = datetime.date.today().strftime('%Y%m%d')
if not os.path.exists('log'):
    os.mkdir('log')
warnings.simplefilter('ignore')
logger.add(f&quot;log/runtime_{now.strftime('%Y%m%d_%H_%M_%S')}.log&quot;)
type_list = ['æœ¬æ–¹+1', 'ä¸­é—´ä»·', 'å¯¹æ‰‹-1']
interval_list = ['1ç§’', '2ç§’', '3ç§’', '4ç§’', '5ç§’', '6ç§’',
                 '7ç§’', '8ç§’', '9ç§’', '10ç§’', '15ç§’', '20ç§’', '30ç§’']
qty_list = [str(i+1) for i in range(30)]
chase_list = ['1T|1|2|M', '1T|2|2|M', '2T|1|2|M', '2T|2|2|M', '1T|2|10|M']


class APIEvent(TradeEvent, QuoteEvent):
    def __init__(self):
        super().__init__()

    def onconnected(self, apitype: str):
        pass

    def ondisconnected(self, apitype: str):
        pass

    def ongreeksreal(self, datatype, symbol, data):
        global greeks_dict
        try:
            greeks_dict[data['Symbol']] = data
        except:
            return

    def onbar(self, datatype, interval, symbol, data, isreal):
        pass

    def onfilledreportreal(self, data):
        global filled_report_dict
        temp_key = '.'.join(data['Symbol'].split('.')[
            2:4])
        if 'A' in temp_key:
            temp_key = temp_key[:-1]
        filled_report_dict[temp_key][data['Symbol'].split(
            '.')[4]][data['DetailReportID']] = data

    def onmargin(self, accmask, data):
        global cash
        global initial_cash
        cash = data[0]['MarketPremium']
        if not cash:
            try:
                cash = initial_cash
            except NameError:
                return

    def onATM(self, datatype, symbol, data):
        global atm_dict
        try:
            if data['ATM'] == '.'.join(data['OTM-1C'].split('.')[6:]):
                atm_dict['.'.join(data['Symbol'].split('.')[2:5])] = {
                    'call': data['OTM-1C'],
                    'put': '.'.join(data['OTM-1C'].split('.')[:5])+'.P.'+data['ATM']
                }
            else:
                atm_dict['.'.join(data['Symbol'].split('.')[2:5])] = {
                    'put': data['OTM-1P'],
                    'call': '.'.join(data['OTM-1P'].split('.')[:5])+'.C.'+data['ATM']
                }
        except:
            return

    def onpositionmoniter(self, data):
        global und_list
        global position_dict
        try:
            und_list
        except:
            return
        try:
            position_dict[und_list[0]]
        except:
            for und in und_list:
                position_dict[und] = {
                    'Total': {'delta': 0, 'vega': 0},
                    month_list[0]: {'delta': 0, 'vega': 0},
                    month_list[1]: {'delta': 0, 'vega': 0}
                }
        for und in und_list:
            for position in data:
                if und in position['Symbol']:
                    position_dict[und][position['SubKey']
                                       ]['delta'] = position['$Delta']
                    position_dict[und][position['SubKey']
                                       ]['vega'] = position['$Vega']


class HedgerVanilla():
    def __init__(self, account, brokerid):
        self.account = account
        self.brokerid = brokerid
        logger.warning(f'å½“å‰ç™»å½•çš„è´¦æˆ·ä¸º{self.account},è¯·ç¡®è®¤åå†ç»§ç»­!')
        global cash
        global initial_cash
        cash = 0
        while not cash:
            cash = api.getaccmargin(
                self.brokerid+'-'+self.account)['MarketPremium']
        initial_cash = cash

    @staticmethod
    def _get_0and1_symbols_and_quote():
        '''æ ¹æ®und_listè®¢é˜…è¯¥æ ‡çš„å¯¹åº”çš„è¿‘æœˆæ¬¡æœˆåˆçº¦greeksåŠatm
        '''
        global und_list
        global greeks_dict
        global atm_dict
        global symbol_dict
        global month_list
        atm_dict = {}
        greeks_dict = {}
        symbol_dict = {}
        for und in und_list:
            all_symbol = api.getallsymbol('OPT', und.split('.')[0])
            symbol_dict[und] = all_symbol
            month_list = list(set([int(symbol.split('.')[4])
                              for symbol in all_symbol]))
            month_list.sort()
            month_list = [str(month) for month in month_list[:2]]
            for month in month_list:
                api.subATM('TC.O.'+und+'.'+month+'.GET.ATM')
            for symbol in all_symbol:
                if und in symbol and (month_list[0] in symbol or month_list[1] in symbol):
                    api.subgreeksreal(symbol)

    @staticmethod
    def _calculate_cashvega_given_und(und, month):
        '''æ ¹æ®å·²æˆäº¤çš„å•è®¡ç®—ç»™å®šæ ‡çš„æœ¬æ¬¡å¯¹å†²(not vega_done)å·²åšçš„cashvega
        '''
        global filled_report_dict
        vega = 0
        temp_symbol = {}
        for order, data in filled_report_dict[und][month].items():
            if data['Symbol'] not in temp_symbol:
                temp_symbol[data['Symbol']] = int(
                    (data['Side']*(-2)+3)*data['MatchedQty'])
            else:
                temp_symbol[data['Symbol']
                            ] += int((data['Side']*(-2)+3)*data['MatchedQty'])
        for symbol, data in temp_symbol.items():
            try:
                vega += data*greeks_dict[symbol]['Vega']*10000
            except TypeError:
                print(f'data:{data}')
                print('vega:', greeks_dict[symbol]['Vega']*10000)
                print('\n'*50)
                continue
        return vega/cash*10000

    @staticmethod
    def _get_order_given_side_and_type(order, side, type_):
        '''æ ¹æ®ä¹°å–æ–¹å‘å’Œä»·æ ¼ç±»å‹ç»™å‡ºorder_obj
        '''
        global order_obj
        order_obj = deepcopy(order)
        order_obj.Side = side
        if side == 1:
            if type_ == 'æœ¬æ–¹+1':
                order_obj.Price = 'BID+1T'
            elif type_ == 'å¯¹æ‰‹-1':
                order_obj.Price = 'ASK-1T'
            else:
                order_obj.OrderType = 15
                order_obj.Synthetic = 1
        else:
            if type_ == 'æœ¬æ–¹+1':
                order_obj.Price = 'ASK-1T'
            elif type_ == 'å¯¹æ‰‹-1':
                order_obj.Price = 'BID+1T'
            else:
                order_obj.OrderType = 15
                order_obj.Synthetic = 1
        return order_obj

    def _do_hedging_thread(self, und, month):
        '''è¿›è¡Œå¯¹å†²å­çº¿ç¨‹
        '''
        global hedging_state_dict
        global filled_report_dict
        global done_vega_dict
        global atm_dict
        global order_type_dict
        global order_interval_dict
        global order_qty_dict
        global chase_type_dict
        done_vega_dict[und][month] = 0
        logger.debug(f'å½“å‰å¼€å§‹{und}_{month}çš„å¯¹å†²å­çº¿ç¨‹')
        if globals()['delta_entry'].get() == '':
            globals()[f'warning_tag_{month}']['text'] = 'è¯·è¾“å…¥ç›®æ ‡delta!'
            logger.debug(f'{und}_{month}å¯¹å†²å­çº¿ç¨‹å› æœªè¾“å…¥ç»ˆæ­¢')
            hedging_state_dict[und][month] = 0
            return
        target_delta = float(globals()['delta_entry'].get())
        if globals()['delta_tol'].get() == '':
            globals()[f'warning_tag_{month}']['text'] = 'è¯·è¾“å…¥deltaèŒƒå›´!'
            logger.debug(f'{und}_{month}å¯¹å†²å­çº¿ç¨‹å› æœªè¾“å…¥ç»ˆæ­¢')
            hedging_state_dict[und][month] = 0
            return
        delta_tol = float(globals()['delta_tol'].get())
        if globals()[f'vega_entry_{month}'].get() == '':
            globals()[f'warning_tag_{month}']['text'] = 'è¯·è¾“å…¥æœ¬æ¬¡vega!'
            logger.debug(f'{und}_{month}å¯¹å†²å­çº¿ç¨‹å› æœªè¾“å…¥ç»ˆæ­¢')
            hedging_state_dict[und][month] = 0
            return
        globals()[f'warning_tag_{month}']['text'] = ''
        target_vega = float(globals()[f'vega_entry_{month}'].get())
        vega_done = False
        first_time = True
        delta_direction_for_first_time = 0
        filled_report_dict[und][month] = {}
        while hedging_state_dict[und][month]:
            try:
                temp_order_type = order_type_dict[und][month]
                temp_order_interval = int(
                    order_interval_dict[und][month].split('ç§’')[0])
                temp_order_qty = int(order_qty_dict[und][month])

                temp_chase_type = chase_type_dict[und][month]
                logger.debug(f'å½“å‰åœ¨{und}_{month}çš„å¯¹å†²å­çº¿ç¨‹ä¸­')
                logger.debug(
                    f'ç›®æ ‡deltaä¸º{target_delta}, å®¹å¿èŒƒå›´æ˜¯{delta_tol}, è¦åšçš„vegaæ˜¯{target_vega}, æœˆä»½ä¸º{month}, ä¸‹å•é—´éš”ä¸º{temp_order_interval}, æ¯ç¬”æ‰‹æ•°ä¸º{temp_order_qty}, ä¸‹å•ç±»å‹ä¸º{temp_order_type}')
                temp_delta = position_dict[und]['Total']['delta']
                logger.debug(
                    f'å½“å‰{month}æœˆä»½temp_deltaä¸º{temp_delta:.0f}, å½“å‰ç›®æ ‡deltaä¸º{target_delta/100*cash}')
                hedger_symbol_call = atm_dict[und+'.'+month]['call']
                hedger_symbol_put = atm_dict[und+'.'+month]['put']
                if not vega_done:  # ä¹‹å‰æœªåšåˆ°è¿‡vega, åˆ™å…ˆåˆ¤æ–­å½“å‰vegaæ˜¯å¦å·²åˆ°
                    done_vega_dict[und][month] = self._calculate_cashvega_given_und(
                        und, month)
                    logger.info(
                        f'å½“å‰å·²åšçš„vegaä¸º {done_vega_dict[und][month]: .1f}')
                    if abs(done_vega_dict[und][month]) &gt;= abs(target_vega):
                        logger.success('å½“å‰é¦–æ¬¡åˆ°è¾¾ç›®æ ‡vega, åç»­åšåˆæˆæœŸè´§!')
                        vega_done = True
                if first_time:  # è‹¥æœªåˆ°è¾¾è¿‡ç›®æ ‡delta, åˆ™åˆ¤æ–­æ‰€åšdeltaæ–¹å‘(é¦–æ¬¡)/å½“å‰æ˜¯å¦åˆ°è¾¾ç›®æ ‡delta
                    if not delta_direction_for_first_time:
                        if temp_delta &gt; target_delta/100*cash &gt;= 0 or (temp_delta &gt; target_delta/100*cash and 0 &gt;= target_delta):
                            delta_direction_for_first_time = -1
                        else:
                            delta_direction_for_first_time = 1
                        logger.debug(
                            f'åˆæ¬¡å¯¹å†², åˆ¤æ–­å¯¹å†²æ–¹å‘ä¸º{delta_direction_for_first_time}')
                    elif (temp_delta-target_delta/100*cash)*delta_direction_for_first_time &gt; 0:
                        logger.info(
                            f'å½“å‰first_time,å½“å‰deltaä¸ç›®æ ‡deltaä¹‹å·®ä¸º{temp_delta-target_delta/100*cash}')
                        first_time = False
                        continue
                order_obj = OrderStruct(Account=self.account,
                                        BrokerID=self.brokerid,
                                        OrderQty=temp_order_qty,
                                        OrderType=2,  # é»˜è®¤é™ä»·å•
                                        Symbol='',
                                        Side=1,
                                        TimeInForce=1,
                                        PositionEffect=4,
                                        SelfTradePrevention=3,
                                        ChasePrice=temp_chase_type)
                if (first_time and temp_delta &lt; target_delta/100*cash) or (not first_time and temp_delta &lt; (target_delta-delta_tol)/100*cash):  # åšæ­£delta
                    logger.info('åˆ¤æ–­æœ¬æ¬¡åšæ­£delta')
                    if not vega_done:  # ä¹°call or å–put
                        if target_vega &gt; 0:  # ä¹°call
                            order = self._get_order_given_side_and_type(
                                order=order_obj, side=1, type_=temp_order_type)
                            order.Symbol = hedger_symbol_call
                        else:  # å–put
                            order = self._get_order_given_side_and_type(
                                order=order_obj, side=2, type_=temp_order_type)
                            order.Symbol = hedger_symbol_put
                        order_response, _ = api.neworder(order)
                    else:  # ä¹°åˆæˆæœŸè´§
                        order_call = self._get_order_given_side_and_type(
                            order=order_obj, side=1, type_=temp_order_type)
                        order_call.Symbol = hedger_symbol_call
                        order_put = self._get_order_given_side_and_type(
                            order=order_obj, side=2, type_=temp_order_type)
                        order_put.Symbol = hedger_symbol_put
                        order_response_call, _ = api.neworder(order_call)
                        order_response_put, _ = api.neworder(order_put)
                elif (first_time and temp_delta &gt; target_delta/100*cash) or (not first_time and temp_delta &gt; (target_delta+delta_tol)/100*cash):  # åšè´Ÿdelta
                    logger.info('åˆ¤æ–­æœ¬æ¬¡åšè´Ÿdelta')
                    if not vega_done:  # å–call or ä¹°put
                        if target_vega &lt; 0:  # å–call
                            order = self._get_order_given_side_and_type(
                                order=order_obj, side=2, type_=temp_order_type)
                            order.Symbol = hedger_symbol_call
                        else:  # ä¹°put
                            order = self._get_order_given_side_and_type(
                                order=order_obj, side=1, type_=temp_order_type)
                            order.Symbol = hedger_symbol_put
                        order_response, _ = api.neworder(order)
                    else:  # å–åˆæˆæœŸè´§
                        order_call = self._get_order_given_side_and_type(
                            order=order_obj, side=2, type_=temp_order_type)
                        order_call.Symbol = hedger_symbol_call
                        order_put = self._get_order_given_side_and_type(
                            order=order_obj, side=1, type_=temp_order_type)
                        order_put.Symbol = hedger_symbol_put
                        order_response_call, _ = api.neworder(order_call)
                        order_response_put, _ = api.neworder(order_put)
                else:
                    logger.debug('å½“å‰deltaæ»¡è¶³è¦æ±‚, ä¸åšå¯¹å†²')
                sleep(temp_order_interval)
            except Exception as error:
                logger.exception(error)
                hedging_state_dict[und][month] = 0
        logger.success(f'{und}å¯¹å†²å­çº¿ç¨‹å·²ç»“æŸ!')
        filled_report_dict[und][month] = {}
        done_vega_dict[und][month] = '-'

    def _do_hedging(self, month):
        '''tk.Buttonç»‘å®šå¼€å§‹å¯¹å†²æŒ‰é”®
        '''
        global hedging_state_dict
        if hedging_state_dict[csd_und][month]:
            logger.warning(f'{csd_und}_{month}å·²åœ¨å¯¹å†²ä¸­')
            return
        global target_delta_dict
        global target_delta_tol_dict
        global target_vega_dict
        global order_type_dict
        global order_interval_dict
        global order_qty_dict
        global chase_type_dict
        target_delta_dict[csd_und] = globals()['delta_entry'].get()
        target_delta_tol_dict[csd_und] = globals()['delta_tol'].get()
        target_vega_dict[csd_und][month] = globals()[
            f'vega_entry_{month}'].get()
        order_type_dict[csd_und][month] = globals(
        )[f'csd_order_type_{month}'].get()
        order_interval_dict[csd_und][month] = globals(
        )[f'csd_order_interval_{month}'].get()
        order_qty_dict[csd_und][month] = globals(
        )[f'csd_order_qty_{month}'].get()
        chase_type_dict[csd_und][month] = globals(
        )[f'csd_chase_type_{month}'].get()
        logger.debug(f'å¼€å§‹å¯¹å†²{csd_und}-{month}')
        hedging_state_dict[csd_und][month] = 1
        globals()[f'hedging_subprocess_{csd_und}_{month}'] = Thread(
            target=self._do_hedging_thread, args=(csd_und, month), daemon=True)
        globals()[f'hedging_subprocess_{csd_und}_{month}'].start()

    def _stop_hedging(self, month):
        '''tk.Buttonç»‘å®šåœæ­¢å¯¹å†²æŒ‰é”®
        '''
        global hedging_state_dict
        if not hedging_state_dict[csd_und][month]:
            logger.warning(f'{csd_und}_{month}æœªåœ¨å¯¹å†²')
            return
        global target_delta_dict
        global target_delta_tol_dict
        global target_vega_dict
        target_delta_dict[csd_und] = ''
        target_delta_tol_dict[csd_und] = ''
        target_vega_dict[csd_und][month] = ''
        hedging_state_dict[csd_und][month] = 0
        logger.debug(f'åœæ­¢å¯¹å†²{csd_und}_{month}')

    def main_window(self):
        '''GUIçª—å£
        '''
        def go(*args):
            pass
        global position_dict
        global und_list
        global month_list
        global hedging_state_dict
        global hedging_state_list
        global done_vega_dict
        global filled_report_dict
        global order_report_dict
        global csd_und
        global target_delta_dict
        global target_vega_dict
        global target_delta_tol_dict
        global order_type_dict
        global order_interval_dict
        global order_qty_dict
        global chase_type_dict
        chase_type_dict = {}
        order_qty_dict = {}
        order_interval_dict = {}
        order_type_dict = {}
        target_delta_tol_dict = {}
        target_vega_dict = {}
        target_delta_dict = {}
        csd_und = und_list[0]
        order_report_dict = {}
        filled_report_dict = {}
        done_vega_dict = {}
        hedging_state_list = ['æœªè¿è¡Œ', 'å¯¹å†²ä¸­']
        hedging_state_dict = {}
        position_dict = {}
        self._get_0and1_symbols_and_quote()
        sleep(3)
        window = Tk()
        window.title('ETFæœŸæƒè‡ªåŠ¨å¯¹å†²åˆç‰ˆ')
        account_tag = Label(text='å½“å‰è´¦æˆ·:')
        account_tag.grid(row=0, column=0)
        account_tag_ = Label(text=self.account)
        account_tag_.grid(row=0, column=1)
        cash_tag = Label(text='å½“å‰èµ„é‡‘:')
        cash_tag.grid(row=1, column=0)
        cash_tag_ = Label(text=f'{cash:.2f}')
        cash_tag_.grid(row=1, column=1)
        for i, und in enumerate(und_list):
            order_report_dict[und] = {}
            done_vega_dict[und] = {
                month_list[0]: '',
                month_list[1]: ''
            }
            hedging_state_dict[und] = {
                month_list[0]: 0,
                month_list[1]: 0
            }
            filled_report_dict[und] = {
                month_list[0]: {},
                month_list[1]: {}
            }
            target_delta_dict[und] = ''
            target_delta_tol_dict[und] = ''
            target_vega_dict[und] = {
                month_list[0]: '',
                month_list[1]: ''
            }
            order_type_dict[und] = {
                month_list[0]: 1,
                month_list[1]: 1
            }
            order_interval_dict[und] = {
                month_list[0]: 1,
                month_list[1]: 1,
            }
            order_qty_dict[und] = {
                month_list[0]: 1,
                month_list[1]: 1,
            }
            chase_type_dict[und] = {
                month_list[0]: 0,
                month_list[1]: 0,
            }
        crt_row = 2
        text_tag = Label(text='å½“å‰æ€»ä½“$delta(ç™¾åˆ†ä¹‹):')
        text_tag.grid(row=crt_row, column=0)
        try:
            globals()['crt_delta_total'] = Label(
                text=str(round(position_dict[csd_und]['Total']['delta']/cash*100, 1)), width=9)
        except KeyError:
            globals()['crt_delta_total'] = Label(
                text=str('-'), width=8)
        globals()['crt_delta_total'].grid(row=crt_row, column=1)
        text_tag = Label(text='', width=8)
        text_tag.grid(row=crt_row, column=2)
        crt_row += 1
        crt_vega = Label(text='å½“å‰æ€»ä½“$vega(ä¸‡åˆ†ä¹‹):')
        crt_vega.grid(row=crt_row, column=0)
        try:
            globals()['crt_vega_total'] = Label(
                text=str(round(position_dict[csd_und]['Total']['vega']/cash*10000, 1)), width=9)
        except KeyError:
            globals()['crt_vega_total'] = Label(
                text=str('-'), width=8)
        globals()['crt_vega_total'].grid(row=crt_row, column=1)
        crt_row += 1

        def choose_und(*args):
            global csd_und
            global target_delta_dict
            global target_delta_tol_dict
            global target_vega_dict
            global order_type_dict
            global order_interval_dict
            global order_qty_dict
            global chase_type_dict
            csd_und = globals()['choose_csd_und'].get()
            globals()['delta_entry'].delete(0, 5)
            globals()['delta_entry'].insert(0, str(target_delta_dict[csd_und]))
            globals()['delta_tol'].delete(0, 5)
            globals()['delta_tol'].insert(
                0, str(target_delta_tol_dict[csd_und]))
            for month in month_list:
                globals()[f'vega_entry_{month}'].delete(0, 5)
                globals()[f'vega_entry_{month}'].insert(
                    0, str(target_vega_dict[csd_und][month]))
                if hedging_state_dict[csd_und][month]:
                    globals()[f'csd_order_type_{month}'].current(
                        type_list.index(order_type_dict[csd_und][month]))
                    globals()[f'csd_order_interval_{month}'].current(
                        interval_list.index(order_interval_dict[csd_und][month]))
                    globals()[f'csd_order_qty_{month}'].current(
                        qty_list.index(order_qty_dict[csd_und][month]))
                    globals()[f'csd_chase_type_{month}'].current(
                        chase_list.index(chase_type_dict[csd_und][month]))
        text_tag = Label(text='é€‰æ‹©å¯¹å†²åˆçº¦:')
        text_tag.grid(row=crt_row, column=0)
        globals()['choose_csd_und'] = ttk.Combobox(
            window, textvariable=StringVar(), width=11)
        globals()['choose_csd_und']['values'] = und_list
        globals()['choose_csd_und'].current(0)
        globals()['choose_csd_und'].bind('&lt;&lt;ComboboxSelected&gt;&gt;', choose_und)
        globals()['choose_csd_und'].grid(row=crt_row, column=1)
        crt_row += 1
        text_tag = Label(text='')
        text_tag.grid(row=crt_row, column=0)
        crt_row += 1
        text_tag = Label(text='å¯¹å†²è®¾ç½®')
        text_tag.grid(row=crt_row, column=0)
        fixed_row_num = crt_row
        col_num = 4

        for i, month in enumerate(month_list):
            crt_row = fixed_row_num
            text_tag = Label(text='è€ƒè™‘æœˆä»½')
            text_tag.grid(row=crt_row, column=i*col_num)
            text_tag = Label(text=month, fg='red')
            text_tag.grid(row=crt_row, column=i*col_num+1)
            crt_row += 1
            text_tag = Label(text='è¯¥æœˆ$delta(ç™¾åˆ†ä¹‹):')
            text_tag.grid(row=crt_row, column=i*col_num)
            try:
                globals()[f'crt_delta_{month}'] = Label(
                    text=str(round(position_dict[csd_und][month]['delta']/cash*100, 1)), width=9)
            except KeyError:
                globals()[f'crt_delta_{month}'] = Label(
                    text=str('-'), width=8)
            globals()[f'crt_delta_{month}'].grid(
                row=crt_row, column=1+i*col_num)
            text_tag = Label(text='', width=8)
            text_tag.grid(row=crt_row, column=2+i*col_num)
            crt_row += 1
            crt_vega = Label(text='è¯¥æœˆ$vega(ä¸‡åˆ†ä¹‹):')
            crt_vega.grid(row=crt_row, column=i*col_num)
            try:
                globals()[f'crt_vega_{month}'] = Label(
                    text=str(round(position_dict[csd_und][month]['vega']/cash*10000, 1)), width=9)
            except KeyError:
                globals()[f'crt_vega_{month}'] = Label(
                    text=str('-'), width=8)
            globals()[f'crt_vega_{month}'].grid(
                row=crt_row, column=1+i*col_num)
            crt_row += 1
            globals()[f'warning_tag_{month}'] = Label(text='', fg='red')
            globals()[f'warning_tag_{month}'].grid(
                row=crt_row, column=1+i*col_num)
            crt_row += 1
            if not i:
                text_tag = Label(text='ç›®æ ‡æ€»delta(ç™¾åˆ†ä¹‹):')
                text_tag.grid(row=crt_row, column=i*col_num)
                globals()['delta_entry'] = Entry(window, width=10)
                globals()['delta_entry'].grid(
                    row=crt_row, column=1+i*col_num)
            crt_row += 1
            if not i:
                text_tag = Label(text='deltaèŒƒå›´(ç™¾åˆ†ä¹‹):')
                text_tag.grid(row=crt_row, column=i*col_num)
                globals()['delta_tol'] = Entry(window, width=10)
                globals()['delta_tol'].grid(
                    row=crt_row, column=1+i*col_num)
            crt_row += 1
            text_tag = Label(text='æœ¬æ¬¡vega(ä¸‡åˆ†ä¹‹):')
            text_tag.grid(row=crt_row, column=i*col_num)
            globals()[f'vega_entry_{month}'] = Entry(window, width=10)
            globals()[f'vega_entry_{month}'].grid(
                row=crt_row, column=1+i*col_num)
            crt_row += 1

            text_tag = Label(text='é€‰æ‹©å¯¹å†²ä¸‹å•æ¨¡å¼:')
            text_tag.grid(row=crt_row, column=i*col_num)
            globals()[f'csd_order_type_{month}'] = ttk.Combobox(
                window, textvariable=StringVar(), width=7)
            globals()[f'csd_order_type_{month}']['values'] = type_list
            globals()[f'csd_order_type_{month}'].current(0)
            globals()[f'csd_order_type_{month}'].bind(
                '&lt;&lt;ComboboxSelected&gt;&gt;', go)
            globals()[f'csd_order_type_{month}'].grid(
                row=crt_row, column=1+i*col_num)
            crt_row += 1

            text_tag = Label(text='é€‰æ‹©ä¸‹å•ç›¸é‚»é—´éš”:')
            text_tag.grid(row=crt_row, column=i*col_num)
            globals()[f'csd_order_interval_{month}'] = ttk.Combobox(
                window, textvariable=StringVar(), width=7)
            globals()[f'csd_order_interval_{month}']['values'] = interval_list
            globals()[f'csd_order_interval_{month}'].current(1)
            globals()[f'csd_order_interval_{month}'].bind(
                '&lt;&lt;ComboboxSelected&gt;&gt;', go)
            globals()[f'csd_order_interval_{month}'].grid(
                row=crt_row, column=1+i*col_num)
            crt_row += 1

            text_tag = Label(text='å¯¹å†²æ¯ç¬”ä¸‹å•å•æ•°:')
            text_tag.grid(row=crt_row, column=i*col_num)
            globals()[f'csd_order_qty_{month}'] = ttk.Combobox(
                window, textvariable=StringVar(), width=7)
            globals()[f'csd_order_qty_{month}']['values'] = qty_list
            globals()[f'csd_order_qty_{month}'].current(0)
            globals()[f'csd_order_qty_{month}'].bind(
                '&lt;&lt;ComboboxSelected&gt;&gt;', go)
            globals()[f'csd_order_qty_{month}'].grid(
                row=crt_row, column=1+i*col_num)
            crt_row += 1

            text_tag = Label(text='é€‰æ‹©å¯¹å†²è¿½ä»·æ–¹å¼:')
            text_tag.grid(row=crt_row, column=i*col_num)
            globals()[f'csd_chase_type_{month}'] = ttk.Combobox(
                window, textvariable=StringVar(), width=7)
            globals()[f'csd_chase_type_{month}']['values'] = chase_list
            globals()[f'csd_chase_type_{month}'].current(3)
            globals()[f'csd_chase_type_{month}'].bind(
                '&lt;&lt;ComboboxSelected&gt;&gt;', go)
            globals()[f'csd_chase_type_{month}'].grid(
                row=crt_row, column=1+i*col_num)
            crt_row += 1
            text_tag = Label(text='')
            text_tag.grid(row=crt_row, column=i*col_num)
            crt_row += 1
            text_tag = Label(text='å½“å‰å¯¹å†²çŠ¶æ€:')
            text_tag.grid(row=crt_row, column=i*col_num)
            globals()[f'hedging_state_{month}'] = Label(
                text=hedging_state_list[hedging_state_dict[und][month]], fg='red')
            globals()[f'hedging_state_{month}'].grid(
                row=crt_row, column=1+i*col_num)
            crt_row += 1
            text_tag = Label(text='å½“å‰å·²åšvega:')
            text_tag.grid(row=crt_row, column=i*col_num)
            globals()[f'done_vega_{month}'] = Label(text='0')
            globals()[f'done_vega_{month}'].grid(
                row=crt_row, column=1+i*col_num)
            crt_row += 1
            Button(window, text=&quot;å¼€å§‹å¯¹å†²&quot;, width=10, command=partial(
                self._do_hedging, month)).grid(row=crt_row, column=i*col_num, padx=1, pady=1)
            crt_row += 1
            Button(window, text=&quot;åœæ­¢å¯¹å†²&quot;, width=10, command=partial(
                self._stop_hedging, month)).grid(row=crt_row, column=i*col_num, padx=1, pady=1)

        crt_row += 1
        text_tag = Label(text='')
        text_tag.grid(row=crt_row, column=0)
        crt_row += 1
        text_tag = Label(text='æ³¨æ„äº‹é¡¹:', fg='red')
        text_tag.grid(row=crt_row, column=0)
        crt_row += 1
        text_tag = Label(
            text='ç›®æ ‡delta, deltaèŒƒå›´, æœ¬æ¬¡vegaä¸‰ä¸ªè¾“å‡ºæ ä¸å¯åœ¨å¯¹å†²ä¸­è¿›è¡Œæ›´æ”¹!(å¾…æ›´æ”¹)', fg='red')
        text_tag.grid(row=crt_row, column=0, columnspan=6)
        crt_row += 1
        text_tag = Label(
            text='è¿½ä»·æ–¹å¼å‚æ•°ä¸º&quot;é€’å¢tick|è¿½å‡ æ¬¡|æ¯æ¬¡å‡ ç§’|M&quot;', fg='red')
        text_tag.grid(row=crt_row, column=0, columnspan=5)

        def update():
            while True:
                sleep(0.5)
                cash_tag_['text'] = f'{cash:.2f}'
                try:
                    globals()['crt_delta_total']['text'] = str(
                        round(position_dict[csd_und]['Total']['delta']/cash*100, 1))
                except KeyError:
                    globals()['crt_delta_total']['text'] = str('-')
                try:
                    globals()['crt_vega_total']['text'] = str(
                        round(position_dict[csd_und]['Total']['vega']/cash*10000, 1))
                except KeyError:
                    globals()['crt_vega_total']['text'] = str('-')
                for month in month_list:
                    try:
                        globals()[f'crt_delta_{month}']['text'] = str(
                            round(position_dict[csd_und][month]['delta']/cash*100, 1))
                    except KeyError:
                        globals()[f'crt_delta_{month}']['text'] = str('-')
                    try:
                        globals()[f'crt_vega_{month}']['text'] = str(
                            round(position_dict[csd_und][month]['vega']/cash*10000, 1))
                    except KeyError:
                        globals()[f'crt_vega_{month}']['text'] = str('-')
                    globals()[
                        f'hedging_state_{month}']['text'] = hedging_state_list[hedging_state_dict[csd_und][month]]
                    try:
                        globals()[f'done_vega_{month}']['text'] = str(
                            round(done_vega_dict[csd_und][month], 1))
                    except TypeError:
                        globals()[f'done_vega_{month}']['text'] = '-'
                    if hedging_state_dict[csd_und][month]:
                        order_type_dict[csd_und][month] = globals(
                        )[f'csd_order_type_{month}'].get()
                        order_interval_dict[csd_und][month] = globals(
                        )[f'csd_order_interval_{month}'].get()
                        order_qty_dict[csd_und][month] = globals(
                        )[f'csd_order_qty_{month}'].get()
                        chase_type_dict[csd_und][month] = globals(
                        )[f'csd_chase_type_{month}'].get()

        def monitor(window):
            window.after(100, update())
        update_thread = Thread(
            target=update, daemon=True, name='update_thread')
        monitor_thread = Thread(
            target=monitor, args=(window), daemon=True, name='monitor_thread')
        update_thread.start()
        monitor_thread.start()
        window.mainloop()


if __name__ == '__main__':
    api = TCoreAPI(APIEvent)
    re = api.connect()
    account_info = api.getaccountlist()
    account = account_info[0]['Account']
    brokerid = account_info[0]['BrokerID']
    global und_list
    und_list = ['SSE.510050', 'SSE.510300', 'SSE.510500', 'SZSE.159915']
    hedger = HedgerVanilla(account=account, brokerid=brokerid)
    hedger.main_window()

</code></pre>

                    <div id="giscus-container"></div>
                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    <a rel="prev" href="../../../option/automatic_trading/automatic_hedging/automatic_hedging_pre.html" class="mobile-nav-chapters previous"
                        title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>


                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="../../../option/automatic_trading/automatic_hedging/automatic_hedging_pre.html" class="nav-chapters previous" title="Previous chapter"
                aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

        </nav>

    </div>




    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="../../../ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../searcher.js" type="text/javascript" charset="utf-8"></script>

    <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        var pagePath = "option/automatic_trading/automatic_hedging/hedging_vanilla.md"
    </script>


    <!-- Custom JS scripts -->
    <script type="text/javascript" src="../../../assets/custom.js"></script>
    <script type="text/javascript" src="../../../assets/bigPicture.js"></script>


</body>

</html>